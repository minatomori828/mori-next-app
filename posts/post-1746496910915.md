---
title: "二日間も悩んだ内容のまとめ"
date: "2025-05-06"
description: "記事を送る、受け取る"
tags: [""]
---

📄 app/admin/page.tsx
役割
ユーザーが新しい記事を投稿できる管理ページ（クライアントサイド）。フォームから記事情報を送信。

主な処理の流れ
各入力値（タイトル・日付など）を useState で管理

handleSubmit で /api/posts に POST リクエストを送信

投稿成功後、リダイレクトまたはアラート表示

注意点
tags は文字列の配列に変換（,区切り）

use client をファイル冒頭に必ず記述（クライアントコンポーネントのため）

📄 app/api/posts/route.ts
役割
フォームから受け取った記事データを、Markdown形式のファイルとして /posts フォルダに保存する（サーバーサイドAPI）。

主な処理の流れ
受け取った JSON をパース

slugify を使って日本語タイトルも英語URLに変換（例: "こんにちは" → konnichiha）

.md ファイルに記事データを保存（YAML frontmatter + content）

注意点
タイトルが重複している場合は保存しない（上書き防止）

"${date}" のように、文字列に " " をつけて保存しないと後で読み込み時に Date として誤解される可能性がある

tags を ["a", "b"] のように保存するため、 map(...).join(', ') が使われている

📄 utils/getPostBySlug.ts
役割
特定のスラッグ（ファイル名）に対応する .md ファイルを読み取り、記事データを抽出して返す。

主な処理の流れ
slug からファイルパスを生成（例: "hello-world" → /posts/hello-world.md）

ファイルを読み取り、gray-matter でメタデータと本文に分解

marked で Markdown → HTML に変換し、記事オブジェクトとして返す

注意点
ファイル読み込みに fs/promises を使用（await 必須）

date は "文字列" に統一して返す（コンポーネント側で Date.parse() するため）

✅ なぜ表示されなかったのか？
原因	説明
日本語タイトル	slugify を使用せずに保存すると、ファイル名が テスト.md など日本語になり、URLに使うとブラウザが自動でエンコードして /%E3%83%86%E3%82%B9%E3%83%88 になり、Next.js では別物として扱われる
解決策	投稿保存時に slugify(title) を使って、URLに安全な英語スラッグを強制生成した

🛠 今後の改善案
フォーム送信後、自動で /posts/[slug] に router.push() で遷移する

投稿成功時にタイトル入力欄だけ空に戻し、他の入力値は保持してもいい

投稿者名やカテゴリーなども拡張できるようにする
